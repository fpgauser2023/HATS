
# HATS: Hardware Acceleration Toolset for the Sigmoid Function
This repository provides the source code developed for the paper **HATS: Hardware Acceleration Toolset for the Sigmoid Function**, as well as instruction on how to build and deploy the various experiments.

# Folder Structure
    .
    ├── hdl/chisel                       # Chisel implementation of various sigmoid function approximations
    |   ├── generated                    # Verilog output generated by Chisel modules
    |   ├── project                      # Chisel projects configurations
    |   ├── script                       # Plot generation scripts
    |   └── src 
    |       ├── main                     # Chisel implementation source files
    |       └── test                     # Test source files
    ├── lamp                             # DPU integration with sigmoid functions source files
    |   ├── hls                          # HLS implementation of ultra-fast sigmoid
    |   ├── includes                     # Common include files
    |   |── vitis
    |   |   ├── DPUCAHX8H                # DPU ip source files
    |   |   ├── sigmoid_approximations   # Sigmoid approximations ip with AXI stream interface
    |   |   |   ├── spt
    |   |   |   ├── ufspl_multi
    |   |   |   ├── ufspl_pipelined
    |   |   |   └── ufspt
    |   |   └── sigmoid_wrapper_kernel   # Memory mapped AXI interface for sigmoid ips
    |   ├── Makefile
    |   ├── config_ip.mk
    |   ├── gen_xo.tcl
    |   └── utils.mk
    |    
    ├── project                          # Chisel build configurations
    ├── LICENSE
    └── README.md
# LAMP Inference 
:pushpin: **Note:** This application can be run only on **Alveo  U280** and requires Vivado and Vitis 2021.2 tools.
## Generate xclbin

* Download dpu xo file
    ```sh
    cd ${HATS_HOME}/lamp/vitis/DPUCAHX8Hu280
    wget https://www.xilinx.com/bin/public/openDownload?filename=DPUCAHX8H.tar.gz
    tar -xzvf DPUCAHX8H.tar.gz
    cp -rf DPUCAHX8H/release_u280_xo bit_gen/release_u280_xo
    ```

* Open a linux terminal and execute following instruction.
    ```sh
    make u280 SIGMOID=<sigmoid implementation>
    ```
sigmoid implementation options are:


|  SIGMOID                   | Desription                                                                         |
|------------------------|------------------------------|------------------------------------------------------------------------------------|
| hls        | Ultra-Fast sigmoid implementation in HLS                                                                   |
| spt         | sigmoid piecewise Taylor                                                   |
| ufspl_multi        | Ultra-Fast sigmoid piecewise linear multi-cycle                       
| ufspl_pipelined      |  Ultra-Fast sigmoid piecewise linear pipelined               
|ufspt| Ultra-Fast sigmoid piecewise taylor 
Note that 
- Generated xclbin will be here **${HATS_HOME}/lamp/vitis/DPUCAHX8H_u280/bit_gen/u280.xclbin**.
- Build runtime is  ~22 hours.
## Running LAMP inference
Please refer to [FA-LAMP repository](https://github.com/aminiok1/LAMP-FPGA) for instructions on compiling the LAMP model for DPU and running the inference. 
